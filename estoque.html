<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <title>Estoque de EPIs</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    .btn-azul {
      background-color: #2196F3;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 4px;
      cursor: pointer;
    }

    .btn-azul:hover {
      background-color: #1976D2;
    }

    .btn-vermelho {
      background-color: #f44336;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 4px;
      cursor: pointer;
    }

    .btn-vermelho:hover {
      background-color: #d32f2f;
    }

    .centralizado {
      text-align: center;
      margin-top: 20px;
    }
  </style>
</head>
 <script type="module">
  // Importações do Firebase SDK
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-analytics.js";
  import { getFirestore, collection, getDocs, addDoc, doc, deleteDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-firestore.js";

  // Configuração do Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyC_dAH7O5mIbgo5NVUhd9NJ04btE0ozIr0",
    authDomain: "painel-epis.firebaseapp.com",
    projectId: "painel-epis",
    storageBucket: "painel-epis.firebasestorage.app",
    messagingSenderId: "711530629275",
    appId: "1:711530629275:web:34ca23bdcc05f47e069e3e",
    measurementId: "G-7MFP3DJNJN"
  };

  // Inicializa Firebase
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
  const db = getFirestore(app);

  // Função exemplo: carregar todos os EPIs
  async function carregarEPIs() {
    const snapshot = await getDocs(collection(db, "epis"));
    const epis = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
    console.log("EPIs carregados:", epis);
    // Aqui você pode chamar renderizarEstoque(epis) se quiser exibir na página
  }

  // Função exemplo: adicionar um EPI
  async function adicionarEPI(epi) {
    await addDoc(collection(db, "epis"), epi);
    console.log("EPI adicionado!");
  }

  // Função exemplo: deletar um EPI
  async function deletarEPI(id) {
    await deleteDoc(doc(db, "epis", id));
    console.log("EPI deletado!");
  }

  // Função exemplo: atualizar um EPI
  async function atualizarEPI(id, novosDados) {
    await updateDoc(doc(db, "epis", id), novosDados);
    console.log("EPI atualizado!");
  }

  // Exemplo: executar carregamento ao iniciar
  carregarEPIs();

  // Exemplo: adicionar um item (remova depois que testar)
  /*
  adicionarEPI({
    nome: "Luva de proteção",
    quantidade: 10,
    categoria: "Proteção Mãos",
    tamanho: "M"
  });
  */

</script>

<body>
  <h1>Estoque de EPIs</h1>

  <form id="formAdicionarEPI">
    <input type="text" name="nome" placeholder="Nome do EPI" required />
    <input type="number" name="quantidade" placeholder="Quantidade" required />
    <input type="text" name="categoria" placeholder="Categoria do EPI" required />
    <input type="text" name="tamanho" placeholder="Tamanho (opcional)" />
    <button type="submit">Adicionar EPI</button>
  </form>

  <div class="centralizado">
    <input type="text" id="buscaNome" placeholder="Filtrar por Nome, Categoria ou Tamanho..." />
  </div>
  <div style="text-align:center; margin: 20px;">
    <a href="index.html"><button>Voltar ao Início</button></a>
    <a href="retiradas.html"><button>Ir para Retiradas</button></a>
  </div>
  <table border="1" id="tabelaEstoque">
    <thead>
      <tr>
        <th>Nome do EPI</th>
        <th>Quantidade</th>
        <th>Categoria</th>
        <th>Tamanho</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody>
      <!-- Populado via JS -->
    </tbody>
  </table>

<script>
  // Utilitários para localStorage
  function carregarLocal(chave) {
    return JSON.parse(localStorage.getItem(chave)) || [];
  }

  function salvarLocal(chave, valor) {
    localStorage.setItem(chave, JSON.stringify(valor));
  }

  // Renderiza os EPIs na tabela
  function renderizarEstoque() {
    const tbody = document.querySelector('#tabelaEstoque tbody');
    const epis = carregarLocal('epis');
    tbody.innerHTML = '';

    epis.forEach((epi) => {
      tbody.innerHTML += `
        <tr>
          <td>${epi.nome}</td>
          <td>${epi.quantidade}</td>
          <td>${epi.categoria}</td>
          <td>${epi.tamanho || '-'}</td>
          <td>
            <button class="btn-azul" onclick="editarEpi('${epi.id}')">Editar</button>
            <button class="btn-vermelho" onclick="deletarEpi('${epi.id}')">Excluir</button>
          </td>
        </tr>
      `;
    });
  }

  // Redireciona para a página de edição com o ID do EPI
    function editarEpi(id) {
  window.location.href = `editar_epi.html?id=${encodeURIComponent(id)}`;
}

  // Remove um EPI do localStorage
  function deletarEpi(id) {
    let epis = carregarLocal('epis');
    epis = epis.filter((e) => e.id !== id);
    salvarLocal('epis', epis);
    renderizarEstoque();
  }

  // Adiciona ou atualiza um EPI
  function adicionarOuSomarEPI(nome, quantidade, categoria, tamanho) {
    const epis = carregarLocal('epis');

    const nomeTrim = nome.trim();
    const categoriaTrim = categoria.trim();
    const tamanhoTrim = tamanho.trim() || '-';

    const epiExistente = epis.find(e =>
      e.nome.toLowerCase() === nomeTrim.toLowerCase() &&
      e.categoria.toLowerCase() === categoriaTrim.toLowerCase() &&
      (e.tamanho || '-') === tamanhoTrim
    );

    if (epiExistente) {
      // Soma a quantidade se já existe
      epiExistente.quantidade += quantidade;
    } else {
      // Adiciona novo EPI
      epis.push({
        id: crypto.randomUUID(),
        nome: nomeTrim,
        quantidade,
        categoria: categoriaTrim,
        tamanho: tamanhoTrim
      });
    }

    salvarLocal('epis', epis);
  }

  // Evento ao carregar a página
  document.addEventListener('DOMContentLoaded', () => {
    renderizarEstoque();

    // Evento para adicionar EPI
    const form = document.querySelector('#formAdicionarEPI');
    form.addEventListener('submit', (e) => {
      e.preventDefault();

      const nome = form.nome.value;
      const quantidade = parseInt(form.quantidade.value);
      const categoria = form.categoria.value;
      const tamanho = form.tamanho.value;

      adicionarOuSomarEPI(nome, quantidade, categoria, tamanho);

      form.reset();
      renderizarEstoque();
    });

    // Filtro de busca
    document.querySelector('#buscaNome').addEventListener('input', function () {
      const filtro = this.value.toLowerCase();
      const linhas = document.querySelectorAll('#tabelaEstoque tbody tr');
      linhas.forEach(linha => {
        const nome = linha.cells[0].textContent.toLowerCase();
        const categoria = linha.cells[2].textContent.toLowerCase();
        const tamanho = linha.cells[3].textContent.toLowerCase();
        const corresponde = nome.includes(filtro) || categoria.includes(filtro) || tamanho.includes(filtro);
        linha.style.display = corresponde ? '' : 'none';
      });
    });
  });
</script>


</body>
</html>

